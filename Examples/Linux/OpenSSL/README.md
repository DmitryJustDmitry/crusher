Нахождение аварийного завершения OpenSSL-сервера, соответствующего уязвимости `CVE-2016-6309`.

Демонстрируются следующие возможности фаззера:

1) Описание формата данных с помощью `Peach Pit` (модифицированного для `Crusher`);

2) Замена вызовов некоторых функций целевой программы пользовательскими во время фаззинга.
Т.к. речь идёт о сетевых функциях, которые работают медленно - обеспечивается ускорение запусков в десятки раз.
Более подробно - см. раздел `"PRELOAD"` в документации фаззера.

Ниже представлены все этапы от подготовки к фаззингу до воспроизведения креша.

# Сборка OpenSSL со статической инструментацией
Выполните команды в терминале (обратите внимание, что нужно указать актуальный путь до фаззера):
```bash
wget https://github.com/openssl/openssl/archive/OpenSSL_1_1_0a.tar.gz
tar xvf OpenSSL_1_1_0a.tar.gz
mkdir openssl
cd openssl-OpenSSL_1_1_0a
CC=/path/to/crusher/bin_x86-64/isp-gcc ./config --prefix=$PWD/../openssl/
make -j 4
make install
cd ..
```

# Генерация SSL-сертификатов
```bash
mkdir keys
./openssl/bin/openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout keys/key.pem -out keys/cert.pem -batch
```

# Фаззинг
Скомпилировать разделяемую библиотеку для замены некоторых сетевых функций (для ускорения фаззинга):
```bash
cd custom_lib/
make
cd ..
```

Для правильного детектирования аварийных завершений целевой программы со статической инструментацией выполнить:
```bash
sudo su
echo core >/proc/sys/kernel/core_pattern
exit
```

Запустить фаззинг (`"-c 4"` - запуск на 4 ядрах):
```bash
ISP_PRELOAD=$PWD/custom_lib/custom_lib.so ./fuzz.sh -f /path/to/crusher/bin_x86-64/fuzz_manager -c 4
```

Запустить в другом терминале UI фаззера:
```bash
/path/to/crusher/bin_x86-64/ui -o out
```

В правом верхнем углу окна пользовательского интерфейса можно наблюдать окно `Stats`. В нём обратите внимание на поле `unique_crashes`.
Как только будет найдено аварийное завершение, значение поля `unique_crashes` станет ненулевым. Пока значение поля нулевое - не останавливайте фаззинг.
Желательно дождаться, когда значение поля будет больше 1. После этого можно остановить фаззинг:

* в терминале с `UI` (пользовательский интерфейс) - для выхода из `UI` нажмите кнопку `q`;
* в терминале с запущенным фаззингом завершите фаззинг по комбинации клавиш `Ctrl+C`.

# Воспроизведение аварийного завершения
1) Получить список креш-файлов:
```bash
find out -name id_crash_*
```

2) Запуск сервера (будет слушать порт 4444):
````bash
./run_server.sh
````

3) Запуск клиента (в другом терминале):
```bash
python run_client.py --ip 127.0.0.1 --port 4444 --crash-path <crash_path>
```

где `<crash_path>` - один из файлов, полученных в п. 1)

4) В терминале с сервером наблюдаем его аварийное завершение.
Если аварийного завершения не произошло, то повторяем п. 3) с другим файлом из п. 1)
