В `Crusher` есть возможность использования пользовательских мутаторов.

Пользовательский мутатор представляют из себя плагин на языке программирования `Python`.

Для использования пользовательского мутатора необходимо выполнить следующие действия:
* написать плагин;
* добавить плагин в `Crusher`;
* добавить новый мутатор в конфиг-файл для запуска `Crusher`;
* запустить `Crusher` с этим конфиг-файлом.

### Написание плагина
Плагин представляет из себя `.py` файл со следующими необходимыми компонентами:
* функция инициализации `initialization()`;
* класс мутатора.

#### Функция `initialization()`
Функция `initialization()` возвращает словарь, который должен содержать следующие поля:

* `mut_name` - имя мутации (имя файла плагина без расширения);

* `class` - имя класса мутатора;

* `method` - имя метода класса мутатора, реализующий алгоритм мутации.

Пример функции `initialization()`:

```python
def initialization():
    info_mut_alg = {"mut_name": "duplicate_mutator",
                    "class": "DuplicateMutator", 
                    "method": "perform_mutation"}
    return info_mut_alg
```

#### Класс мутатора
Имя класса должно соответствовать значению поля `"class"` из словаря, возвращаемого функцией `initialization`.

##### Конструктор

Конструктор класса мутатора обязательно должен содержать следующий код (для правильной инициализации плагина в `Crusher`):
```python
    def __init__(self, init=None):
        if not init is None:
            self.init = True
        else:
            self.init = False
```

При этом в конструкторе могут инициализироваться любые другие поля, необходимые для мутации.

##### Метод мутации
Имя метода должно соответствовать значению поля `"method"` из словаря, возвращаемого функцией `initialization`.

Метод принимает в качестве аргумента массив байт (`bytearray`) - буфер, который передаёт ядро `Crusher` для мутаций, и возвращает также массив байт.

Метод должен обязательно содержать следующий код (для правильной его инициализации в `Crusher`):
```python
    def perform_mutation(self, data=None):
        if self.init:
            self.init = False
            return 42
```

Предполагается, что в остальной части тела метода проводятся манипуляции над `data` и возвращается новый массив байт.
Однако, использование `data` не является обязательным.

### Добавление плагина в `Crusher`
Скопируйте плагин мутатора (например, `duplicate_mutator.py`) в директорию с пользовательскими мутаторами `Crusher`:
```shell script
cp duplicate_mutator.py /path/to/crusher/bin_x86-64/Plugins/mutation
```

### Добавление мутатора в конфиг-файл для `Crusher`
Конфиг-файла для `Crusher` (наряду с аргументами командной строки) позволяет более тонко настраивать его работу. Используется формат `JSON`.

Для использования нового мутатора при фаззинге нужно добавить его имя в список мутаторов в поле `"mutation"` в конфиг-файле.

Важно помнить, что по умолчанию программа не будет запускаться фаззером после применения пользовательской мутации к данным. Это оставляет возможность применения сразу нескольких мутаций перед запуском программы.

Для запуска программы после применения пользовательского мутатора нужно явно указать это в конфиг-файле - добавить имя мутатора в соответствующий список в поле `"run_after_mutation"`.

Пример конфиг-файла с мутатором `duplicate_mutator`:
```json
{
  "mutation": ["duplicate_mutator"],
  "run_after_mutation": ["duplicate_mutator"]
}
```

### Запуск `Crusher`
Пример запуска `Crusher` с пользовательским мутатором, где `config.json` - конфиг-файл:
```shell script
/path/to/crusher/bin_x86-64/fuzz_manager --start 4 -i in -o out --config-file config.json -- ./test @@
```

### Пример
Пример плагина мутации - файл `duplicate_mutator.py`

Пример конфиг-файла - файл `config.json`
